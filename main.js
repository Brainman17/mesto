(()=>{"use strict";const e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_invalid",inputMarginOut:"popup__input_margin_out",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};class t{constructor(e,t){this._formElement=t,this._config=e}_checkInputValidity=e=>{const t=document.querySelector(`#${e.id}-error`);e.validity.valid?(t.textContent="",e.classList.remove(this._config.errorClass,this._config.inputMarginOut),t.classList.remove(this._config.inputErrorClass)):(t.textContent=e.validationMessage,e.classList.add(this._config.errorClass,this._config.inputMarginOut),t.classList.add(this._config.inputErrorClass))};_toggleButtonVisibility=()=>{this._inputs.every((e=>e.validity.valid))?(this._button.classList.remove(this._config.inactiveButtonClass),this._button.disabled=!1):(this._button.classList.add(this._config.inactiveButtonClass),this._button.disabled=!0)};enableValidation=()=>{this._inputs=[...this._formElement.querySelectorAll(this._config.inputSelector)],this._button=this._formElement.querySelector(this._config.submitButtonSelector),this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._formElement.addEventListener("reset",(()=>{setTimeout((()=>{this._toggleButtonVisibility()}),0)})),this._inputs.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonVisibility()}))}))}}class s{constructor(e,t,s){this._data=e,this._templateSelector=t,this._handleImageClick=s}_getTemplate=()=>document.querySelector(this._templateSelector).content.querySelector(".card").cloneNode(!0);_handleDeleteButtonClick(){this._cardTemplate.remove()}_handleLikeButtonClick(){this._buttonLike.classList.toggle("card__heart-button_active")}_addEventListeners(){this._buttonDelete=this._cardTemplate.querySelector(".card__delete-button"),this._buttonLike=this._cardTemplate.querySelector(".card__heart-button"),this._buttonDelete.addEventListener("click",(()=>this._handleDeleteButtonClick())),this._buttonLike.addEventListener("click",(()=>this._handleLikeButtonClick())),this._cardElementImage.addEventListener("click",(()=>this._handleImageClick(this._data.name,this._data.link)))}generateCard(){return this._cardTemplate=this._getTemplate(),this._cardElementImage=this._cardTemplate.querySelector(".card__image"),this._cardElementTitle=this._cardTemplate.querySelector(".card__subtitle"),this._cardElementImage.src=this._data.link,this._cardElementImage.alt=this._data.name,this._cardElementTitle.textContent=this._data.name,this._addEventListeners(),this._cardTemplate}}class n{constructor(e){this._popup=document.querySelector(e)}_handleEscClose=e=>{"Escape"===e.key&&this.close()};open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._popup.addEventListener("mousedown",(e=>{e.target.classList.contains("popup_opened")&&this.close(),e.target.classList.contains("popup__close-button")&&this.close()}))}}class i extends n{constructor(e,t){super(e),this._handleSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._inputs=[...this._form.querySelectorAll(".popup__input")]}_getInputValues(){const e={};return this._inputs.forEach((t=>{const s=t.name,n=t.value;e[s]=n})),e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{this._handleSubmit(e,this._getInputValues())}))}close(){super.close(),this._form.reset()}setFormValues(e){this._inputs.forEach((t=>{const s=t.name;e[s]&&(t.value=e[s])}))}}const o=document.querySelector(".profile__add-button"),r=document.querySelector(".profile__edit-button"),a=document.forms["form-edit"],c=document.forms["form-add"];function l(e){const t=new s(e,"#card-template",p).generateCard();d.addItem(t)}function p(e,t){h.open(e,t)}o.addEventListener("click",(()=>{u.open()})),r.addEventListener("click",(()=>{const{name:e,about:t}=m.getUserInfo();_.setFormValues({name:e,about:t}),_.open()}));const d=new class{constructor({initialCards:e,renderer:t},s){this._initialCards=e,this._renderer=t,this._cardsContainer=document.querySelector(s)}renderItems(){this._initialCards.forEach((e=>{this._renderer(e)}))}addItem(e){this._cardsContainer.prepend(e)}}({initialCards:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],renderer:e=>{l(e)}},".cards");d.renderItems();const u=new i(".popup_add",(function(e,t){e.preventDefault(),l(t),u.close()}));u.setEventListeners();const _=new i(".popup_edit",(function(e,t){e.preventDefault(),m.setUserInfo(t.name,t.about),_.close()}));_.setEventListeners();const h=new class extends n{open(e,t){this._popupCardImage=this._popup.querySelector(".popup__card-img"),this._popupCardSubtitle=this._popup.querySelector(".popup__card-subtitle"),this._popupCardSubtitle.textContent=e,this._popupCardImage.alt=e,this._popupCardImage.src=t,super.open()}}(".popup_card");h.setEventListeners();const m=new class{constructor({userNameSelector:e,userJobSelector:t}){this._name=document.querySelector(e),this._job=document.querySelector(t)}getUserInfo(){return{name:this._name.textContent,about:this._job.textContent}}setUserInfo(e,t){this._name.textContent=e,this._job.textContent=t}}({userNameSelector:".profile__title",userJobSelector:".profile__subtitle"});new t(e,a).enableValidation(),new t(e,c).enableValidation()})();